{"ast":null,"code":"// src/hooks/useWebSocket.js\nimport{useState,useEffect,useCallback}from'react';const WS_URL='ws://218.156.126.186:8000/ws';function useWebSocket(user){const[socket,setSocket]=useState(null);const[messages,setMessages]=useState([]);const[userCount,setUserCount]=useState(0);const[chatBanTimeLeft,setChatBanTimeLeft]=useState(0);const setupWebSocket=useCallback(()=>{if(!user)return;const newSocket=new WebSocket(`${WS_URL}/${user.userId}`);newSocket.onopen=()=>{console.log('WebSocket Connected');setSocket(newSocket);};newSocket.onmessage=event=>{const data=JSON.parse(event.data);if(data.type==='user_count'){setUserCount(data.count);}else if(data.type==='chat_banned'){setChatBanTimeLeft(data.time_left);}else{setMessages(prev=>[...prev,data]);}};newSocket.onclose=()=>{console.log('WebSocket Disconnected');setTimeout(setupWebSocket,5000);};newSocket.onerror=error=>{console.error('WebSocket Error:',error);};return()=>{newSocket.close();};},[user]);useEffect(()=>{const cleanup=setupWebSocket();return cleanup;},[setupWebSocket]);const sendMessage=useCallback(messageText=>{if(socket&&socket.readyState===WebSocket.OPEN&&user){const messageObj={message:messageText,sender:user.userId,username:user.username,timestamp:Date.now()};socket.send(JSON.stringify(messageObj));}else{console.error('WebSocket is not connected or user is not logged in');}},[socket,user]);return{socket,messages,userCount,chatBanTimeLeft,sendMessage};}export default useWebSocket;","map":{"version":3,"names":["useState","useEffect","useCallback","WS_URL","useWebSocket","user","socket","setSocket","messages","setMessages","userCount","setUserCount","chatBanTimeLeft","setChatBanTimeLeft","setupWebSocket","newSocket","WebSocket","userId","onopen","console","log","onmessage","event","data","JSON","parse","type","count","time_left","prev","onclose","setTimeout","onerror","error","close","cleanup","sendMessage","messageText","readyState","OPEN","messageObj","message","sender","username","timestamp","Date","now","send","stringify"],"sources":["/home/work/chat/front/src/hooks/useWebSocket.js"],"sourcesContent":["// src/hooks/useWebSocket.js\n\nimport { useState, useEffect, useCallback } from 'react';\n\nconst WS_URL = 'ws://218.156.126.186:8000/ws';\n\nfunction useWebSocket(user) {\n  const [socket, setSocket] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [userCount, setUserCount] = useState(0);\n  const [chatBanTimeLeft, setChatBanTimeLeft] = useState(0);\n\n  const setupWebSocket = useCallback(() => {\n    if (!user) return;\n\n    const newSocket = new WebSocket(`${WS_URL}/${user.userId}`);\n\n    newSocket.onopen = () => {\n      console.log('WebSocket Connected');\n      setSocket(newSocket);\n    };\n\n    newSocket.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      if (data.type === 'user_count') {\n        setUserCount(data.count);\n      } else if (data.type === 'chat_banned') {\n        setChatBanTimeLeft(data.time_left);\n      } else {\n        setMessages(prev => [...prev, data]);\n      }\n    };\n\n    newSocket.onclose = () => {\n      console.log('WebSocket Disconnected');\n      setTimeout(setupWebSocket, 5000);\n    };\n\n    newSocket.onerror = (error) => {\n      console.error('WebSocket Error:', error);\n    };\n\n    return () => {\n      newSocket.close();\n    };\n  }, [user]);\n\n  useEffect(() => {\n    const cleanup = setupWebSocket();\n    return cleanup;\n  }, [setupWebSocket]);\n\n  const sendMessage = useCallback((messageText) => {\n    if (socket && socket.readyState === WebSocket.OPEN && user) {\n      const messageObj = {\n        message: messageText,\n        sender: user.userId,\n        username: user.username,\n        timestamp: Date.now()\n      };\n      socket.send(JSON.stringify(messageObj));\n    } else {\n      console.error('WebSocket is not connected or user is not logged in');\n    }\n  }, [socket, user]);\n\n  return { socket, messages, userCount, chatBanTimeLeft, sendMessage };\n}\n\nexport default useWebSocket;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}