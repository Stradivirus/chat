{"ast":null,"code":"import{useState,useEffect,useCallback}from'react';const WS_URL='ws://218.156.126.186:8000/ws';export function useWebSocket(user){const[socket,setSocket]=useState(null);const[userCount,setUserCount]=useState(0);const[showSessionExpiredModal,setShowSessionExpiredModal]=useState(false);const[chatBanTimeLeft,setChatBanTimeLeft]=useState(0);const setupWebSocket=useCallback(()=>{if(!user)return;const newSocket=new WebSocket(`${WS_URL}/${user.userId}`);newSocket.onopen=()=>{console.log('WebSocket Connected');setSocket(newSocket);};newSocket.onmessage=event=>{const data=JSON.parse(event.data);if(data.type==='user_count'){setUserCount(data.count);}else if(data.type==='session_expired'){setShowSessionExpiredModal(true);}else if(data.type==='chat_banned'){setChatBanTimeLeft(data.time_left);}};newSocket.onclose=event=>{if(event.code!==1000){console.log('WebSocket Disconnected');setTimeout(()=>{console.log('Attempting to reconnect...');setupWebSocket();},5000);}};newSocket.onerror=error=>{console.error('WebSocket Error:',error);};},[user]);useEffect(()=>{if(user){setupWebSocket();}return()=>{if(socket){socket.close(1000,\"Intentional disconnect\");}};},[user,setupWebSocket]);useEffect(()=>{if(chatBanTimeLeft>0){const timer=setInterval(()=>{setChatBanTimeLeft(prev=>Math.max(0,prev-1));},1000);return()=>clearInterval(timer);}},[chatBanTimeLeft]);const sendMessage=useCallback(messageObj=>{if(socket&&socket.readyState===WebSocket.OPEN){socket.send(JSON.stringify(messageObj));}else{console.error('WebSocket is not connected');}},[socket]);return{socket,userCount,showSessionExpiredModal,setShowSessionExpiredModal,chatBanTimeLeft,sendMessage};}","map":{"version":3,"names":["useState","useEffect","useCallback","WS_URL","useWebSocket","user","socket","setSocket","userCount","setUserCount","showSessionExpiredModal","setShowSessionExpiredModal","chatBanTimeLeft","setChatBanTimeLeft","setupWebSocket","newSocket","WebSocket","userId","onopen","console","log","onmessage","event","data","JSON","parse","type","count","time_left","onclose","code","setTimeout","onerror","error","close","timer","setInterval","prev","Math","max","clearInterval","sendMessage","messageObj","readyState","OPEN","send","stringify"],"sources":["/home/work/chat/front/src/hooks/useWebSocket.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\n\nconst WS_URL = 'ws://218.156.126.186:8000/ws';\n\nexport function useWebSocket(user) {\n  const [socket, setSocket] = useState(null);\n  const [userCount, setUserCount] = useState(0);\n  const [showSessionExpiredModal, setShowSessionExpiredModal] = useState(false);\n  const [chatBanTimeLeft, setChatBanTimeLeft] = useState(0);\n\n  const setupWebSocket = useCallback(() => {\n    if (!user) return;\n\n    const newSocket = new WebSocket(`${WS_URL}/${user.userId}`);\n\n    newSocket.onopen = () => {\n      console.log('WebSocket Connected');\n      setSocket(newSocket);\n    };\n\n    newSocket.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      if (data.type === 'user_count') {\n        setUserCount(data.count);\n      } else if (data.type === 'session_expired') {\n        setShowSessionExpiredModal(true);\n      } else if (data.type === 'chat_banned') {\n        setChatBanTimeLeft(data.time_left);\n      }\n    };\n\n    newSocket.onclose = (event) => {\n      if (event.code !== 1000) {\n        console.log('WebSocket Disconnected');\n        setTimeout(() => {\n          console.log('Attempting to reconnect...');\n          setupWebSocket();\n        }, 5000);\n      }\n    };\n\n    newSocket.onerror = (error) => {\n      console.error('WebSocket Error:', error);\n    };\n  }, [user]);\n\n  useEffect(() => {\n    if (user) {\n      setupWebSocket();\n    }\n    return () => {\n      if (socket) {\n        socket.close(1000, \"Intentional disconnect\");\n      }\n    };\n  }, [user, setupWebSocket]);\n\n  useEffect(() => {\n    if (chatBanTimeLeft > 0) {\n      const timer = setInterval(() => {\n        setChatBanTimeLeft((prev) => Math.max(0, prev - 1));\n      }, 1000);\n      return () => clearInterval(timer);\n    }\n  }, [chatBanTimeLeft]);\n\n  const sendMessage = useCallback((messageObj) => {\n    if (socket && socket.readyState === WebSocket.OPEN) {\n      socket.send(JSON.stringify(messageObj));\n    } else {\n      console.error('WebSocket is not connected');\n    }\n  }, [socket]);\n\n  return {\n    socket,\n    userCount,\n    showSessionExpiredModal,\n    setShowSessionExpiredModal,\n    chatBanTimeLeft,\n    sendMessage\n  };\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}