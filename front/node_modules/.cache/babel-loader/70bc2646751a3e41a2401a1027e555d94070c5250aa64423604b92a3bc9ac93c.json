{"ast":null,"code":"import React,{useEffect,useRef}from'react';// ChatMessages 컴포넌트: 채팅 메시지를 표시하는 컴포넌트\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function ChatMessages(_ref){let{messages,currentUserId}=_ref;// 메시지 목록의 끝을 참조하기 위한 ref\nconst messagesEndRef=useRef(null);// 메시지 목록의 맨 아래로 스크롤하는 함수\nconst scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:\"smooth\"});};// messages 배열이 변경될 때마다 스크롤을 아래로 이동\nuseEffect(scrollToBottom,[messages]);// Unicode 문자열을 디코딩하는 함수\nconst decodeUnicode=str=>{return str.replace(/\\\\u[\\dA-F]{4}/gi,match=>{return String.fromCharCode(parseInt(match.replace(/\\\\u/g,''),16));});};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-messages\",children:[messages.map((message,index)=>{let messageContent,sender_id,username;// 메시지가 문자열인 경우 JSON 파싱 시도\nif(typeof message==='string'){try{const parsedMessage=JSON.parse(message);messageContent=parsedMessage.message;sender_id=parsedMessage.sender_id;username=parsedMessage.username;}catch(e){console.error(\"Failed to parse message:\",e);return null;}}else{// 메시지가 객체인 경우 직접 값 할당\nmessageContent=message.message;sender_id=message.sender_id;username=message.username;}// 시스템 메시지인 경우 Unicode 디코딩\nif(sender_id==='system'||message.type==='system'){messageContent=decodeUnicode(messageContent);}// 메시지 내용이 없거나 빈 문자열인 경우 렌더링하지 않음\nif(!messageContent||messageContent.trim()===''||messageContent==='내용 없음'){return null;}return/*#__PURE__*/_jsxs(\"div\",{className:`message ${sender_id===currentUserId?'user':sender_id==='system'?'system':'other'}`,children:[sender_id!==currentUserId&&sender_id!=='system'&&/*#__PURE__*/_jsxs(\"span\",{className:\"message-username\",children:[/*#__PURE__*/_jsx(\"strong\",{children:username||'Anonymous'}),\" \"]}),/*#__PURE__*/_jsx(\"span\",{children:messageContent})]},index);}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]});}export default ChatMessages;","map":{"version":3,"names":["React","useEffect","useRef","jsx","_jsx","jsxs","_jsxs","ChatMessages","_ref","messages","currentUserId","messagesEndRef","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","decodeUnicode","str","replace","match","String","fromCharCode","parseInt","className","children","map","message","index","messageContent","sender_id","username","parsedMessage","JSON","parse","e","console","error","type","trim","ref"],"sources":["/home/work/chat/front/src/components/ChatMessages.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\n\n// ChatMessages 컴포넌트: 채팅 메시지를 표시하는 컴포넌트\nfunction ChatMessages({ messages, currentUserId }) {\n  // 메시지 목록의 끝을 참조하기 위한 ref\n  const messagesEndRef = useRef(null);\n\n  // 메시지 목록의 맨 아래로 스크롤하는 함수\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  // messages 배열이 변경될 때마다 스크롤을 아래로 이동\n  useEffect(scrollToBottom, [messages]);\n\n  // Unicode 문자열을 디코딩하는 함수\n  const decodeUnicode = (str) => {\n    return str.replace(/\\\\u[\\dA-F]{4}/gi, (match) => {\n      return String.fromCharCode(parseInt(match.replace(/\\\\u/g, ''), 16));\n    });\n  };\n\n  return (\n    <div className=\"chat-messages\">\n      {messages.map((message, index) => {\n        let messageContent, sender_id, username;\n        \n        // 메시지가 문자열인 경우 JSON 파싱 시도\n        if (typeof message === 'string') {\n          try {\n            const parsedMessage = JSON.parse(message);\n            messageContent = parsedMessage.message;\n            sender_id = parsedMessage.sender_id;\n            username = parsedMessage.username;\n          } catch (e) {\n            console.error(\"Failed to parse message:\", e);\n            return null;\n          }\n        } else {\n          // 메시지가 객체인 경우 직접 값 할당\n          messageContent = message.message;\n          sender_id = message.sender_id;\n          username = message.username;\n        }\n\n        // 시스템 메시지인 경우 Unicode 디코딩\n        if (sender_id === 'system' || message.type === 'system') {\n          messageContent = decodeUnicode(messageContent);\n        }\n\n        // 메시지 내용이 없거나 빈 문자열인 경우 렌더링하지 않음\n        if (!messageContent || messageContent.trim() === '' || messageContent === '내용 없음') {\n          return null;\n        }\n\n        return (\n          <div \n            key={index} \n            className={`message ${sender_id === currentUserId ? 'user' : (sender_id === 'system' ? 'system' : 'other')}`}\n          >\n            {/* 다른 사용자의 메시지인 경우 사용자 이름 표시 */}\n            {sender_id !== currentUserId && sender_id !== 'system' && (\n              <span className=\"message-username\"><strong>{username || 'Anonymous'}</strong> </span>\n            )}\n            <span>{messageContent}</span>\n          </div>\n        );\n      })}\n      {/* 메시지 목록의 끝을 나타내는 빈 div */}\n      <div ref={messagesEndRef} />\n    </div>\n  );\n}\n\nexport default ChatMessages;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,MAAM,KAAQ,OAAO,CAEhD;AAAA,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBACA,QAAS,CAAAC,YAAYA,CAAAC,IAAA,CAA8B,IAA7B,CAAEC,QAAQ,CAAEC,aAAc,CAAC,CAAAF,IAAA,CAC/C;AACA,KAAM,CAAAG,cAAc,CAAGT,MAAM,CAAC,IAAI,CAAC,CAEnC;AACA,KAAM,CAAAU,cAAc,CAAGA,CAAA,GAAM,KAAAC,qBAAA,CAC3B,CAAAA,qBAAA,CAAAF,cAAc,CAACG,OAAO,UAAAD,qBAAA,iBAAtBA,qBAAA,CAAwBE,cAAc,CAAC,CAAEC,QAAQ,CAAE,QAAS,CAAC,CAAC,CAChE,CAAC,CAED;AACAf,SAAS,CAACW,cAAc,CAAE,CAACH,QAAQ,CAAC,CAAC,CAErC;AACA,KAAM,CAAAQ,aAAa,CAAIC,GAAG,EAAK,CAC7B,MAAO,CAAAA,GAAG,CAACC,OAAO,CAAC,iBAAiB,CAAGC,KAAK,EAAK,CAC/C,MAAO,CAAAC,MAAM,CAACC,YAAY,CAACC,QAAQ,CAACH,KAAK,CAACD,OAAO,CAAC,MAAM,CAAE,EAAE,CAAC,CAAE,EAAE,CAAC,CAAC,CACrE,CAAC,CAAC,CACJ,CAAC,CAED,mBACEb,KAAA,QAAKkB,SAAS,CAAC,eAAe,CAAAC,QAAA,EAC3BhB,QAAQ,CAACiB,GAAG,CAAC,CAACC,OAAO,CAAEC,KAAK,GAAK,CAChC,GAAI,CAAAC,cAAc,CAAEC,SAAS,CAAEC,QAAQ,CAEvC;AACA,GAAI,MAAO,CAAAJ,OAAO,GAAK,QAAQ,CAAE,CAC/B,GAAI,CACF,KAAM,CAAAK,aAAa,CAAGC,IAAI,CAACC,KAAK,CAACP,OAAO,CAAC,CACzCE,cAAc,CAAGG,aAAa,CAACL,OAAO,CACtCG,SAAS,CAAGE,aAAa,CAACF,SAAS,CACnCC,QAAQ,CAAGC,aAAa,CAACD,QAAQ,CACnC,CAAE,MAAOI,CAAC,CAAE,CACVC,OAAO,CAACC,KAAK,CAAC,0BAA0B,CAAEF,CAAC,CAAC,CAC5C,MAAO,KAAI,CACb,CACF,CAAC,IAAM,CACL;AACAN,cAAc,CAAGF,OAAO,CAACA,OAAO,CAChCG,SAAS,CAAGH,OAAO,CAACG,SAAS,CAC7BC,QAAQ,CAAGJ,OAAO,CAACI,QAAQ,CAC7B,CAEA;AACA,GAAID,SAAS,GAAK,QAAQ,EAAIH,OAAO,CAACW,IAAI,GAAK,QAAQ,CAAE,CACvDT,cAAc,CAAGZ,aAAa,CAACY,cAAc,CAAC,CAChD,CAEA;AACA,GAAI,CAACA,cAAc,EAAIA,cAAc,CAACU,IAAI,CAAC,CAAC,GAAK,EAAE,EAAIV,cAAc,GAAK,OAAO,CAAE,CACjF,MAAO,KAAI,CACb,CAEA,mBACEvB,KAAA,QAEEkB,SAAS,CAAE,WAAWM,SAAS,GAAKpB,aAAa,CAAG,MAAM,CAAIoB,SAAS,GAAK,QAAQ,CAAG,QAAQ,CAAG,OAAQ,EAAG,CAAAL,QAAA,EAG5GK,SAAS,GAAKpB,aAAa,EAAIoB,SAAS,GAAK,QAAQ,eACpDxB,KAAA,SAAMkB,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAACrB,IAAA,WAAAqB,QAAA,CAASM,QAAQ,EAAI,WAAW,CAAS,CAAC,IAAC,EAAM,CACrF,cACD3B,IAAA,SAAAqB,QAAA,CAAOI,cAAc,CAAO,CAAC,GAPxBD,KAQF,CAAC,CAEV,CAAC,CAAC,cAEFxB,IAAA,QAAKoC,GAAG,CAAE7B,cAAe,CAAE,CAAC,EACzB,CAAC,CAEV,CAEA,cAAe,CAAAJ,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}