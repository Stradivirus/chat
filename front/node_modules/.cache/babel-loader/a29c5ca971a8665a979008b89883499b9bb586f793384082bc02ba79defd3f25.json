{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{ThemeProvider,useTheme}from'./contexts/ThemeContext';import ChatPage from'./pages/ChatPage';import AuthModal from'./components/AuthModal';import'./styles/base.css';import'./styles/components.css';import'./styles/utilities.css';// WebSocket 연결 URL (환경에 따라 변경 필요)\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const WS_URL='ws://218.156.126.186:8000/ws';function AppContent(){const[userCount,setUserCount]=useState(0);const[showAuthModal,setShowAuthModal]=useState(false);const[authType,setAuthType]=useState(null);const{isDarkMode,toggleTheme}=useTheme();const[socket,setSocket]=useState(null);const[user,setUser]=useState(null);const setupWebSocket=useCallback(()=>{if(!user)return;// 사용자가 로그인하지 않았다면 연결하지 않음\nconst newSocket=new WebSocket(`${WS_URL}/${user.id}`);newSocket.onopen=()=>{console.log('WebSocket Connected');setSocket(newSocket);};newSocket.onmessage=event=>{const data=JSON.parse(event.data);if(data.type==='user_count'){setUserCount(data.count);}};newSocket.onclose=()=>{console.log('WebSocket Disconnected');setTimeout(()=>{console.log('Attempting to reconnect...');setupWebSocket();},5000);// 5초 후 재연결 시도\n};newSocket.onerror=error=>{console.error('WebSocket Error:',error);};},[user]);useEffect(()=>{if(user){setupWebSocket();}return()=>{if(socket){socket.close();}};},[user,setupWebSocket]);const handleAuthButton=type=>{setAuthType(type);setShowAuthModal(true);};const handleCloseModal=()=>{setShowAuthModal(false);setAuthType(null);};const handleLoginSuccess=useCallback(userData=>{console.log('Login successful:',userData);setUser(userData);handleCloseModal();},[]);const handleLogout=()=>{setUser(null);if(socket){socket.close();}};return/*#__PURE__*/_jsxs(\"div\",{className:`App ${isDarkMode?'dark-mode':'light-mode'}`,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"main-section\",children:[/*#__PURE__*/_jsx(\"header\",{className:\"main-header\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"\\uCC44\\uD305 \\uC560\\uD50C\\uB9AC\\uCF00\\uC774\\uC158\"})}),/*#__PURE__*/_jsx(\"main\",{className:\"main-content\"})]}),/*#__PURE__*/_jsxs(\"aside\",{className:\"side-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"side-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"user-count\",children:[\"\\uD604\\uC7AC \\uC811\\uC18D\\uC790 \\uC218: \",userCount]}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-buttons\",children:[user?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"span\",{className:\"user-nickname\",children:[user.username,\"\\uB2D8 \\uD658\\uC601\\uD569\\uB2C8\\uB2E4\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,className:\"logout-button\",children:\"\\uB85C\\uADF8\\uC544\\uC6C3\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleAuthButton('login'),children:\"\\uB85C\\uADF8\\uC778\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleAuthButton('register'),children:\"\\uD68C\\uC6D0\\uAC00\\uC785\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleTheme,className:\"theme-toggle\",children:isDarkMode?'라이트':'다크'})]})]}),/*#__PURE__*/_jsx(ChatPage,{socket:socket,user:user})]}),showAuthModal&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-backdrop\",children:/*#__PURE__*/_jsx(AuthModal,{type:authType,onClose:handleCloseModal,onLoginSuccess:handleLoginSuccess})})]});}function App(){return/*#__PURE__*/_jsx(ThemeProvider,{children:/*#__PURE__*/_jsx(AppContent,{})});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useCallback","ThemeProvider","useTheme","ChatPage","AuthModal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","WS_URL","AppContent","userCount","setUserCount","showAuthModal","setShowAuthModal","authType","setAuthType","isDarkMode","toggleTheme","socket","setSocket","user","setUser","setupWebSocket","newSocket","WebSocket","id","onopen","console","log","onmessage","event","data","JSON","parse","type","count","onclose","setTimeout","onerror","error","close","handleAuthButton","handleCloseModal","handleLoginSuccess","userData","handleLogout","className","children","username","onClick","onClose","onLoginSuccess","App"],"sources":["/home/work/chat/front/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { ThemeProvider, useTheme } from './contexts/ThemeContext';\nimport ChatPage from './pages/ChatPage';\nimport AuthModal from './components/AuthModal';\nimport './styles/base.css';\nimport './styles/components.css';\nimport './styles/utilities.css';\n\n// WebSocket 연결 URL (환경에 따라 변경 필요)\nconst WS_URL = 'ws://218.156.126.186:8000/ws';\n\nfunction AppContent() {\n  const [userCount, setUserCount] = useState(0);\n  const [showAuthModal, setShowAuthModal] = useState(false);\n  const [authType, setAuthType] = useState(null);\n  const { isDarkMode, toggleTheme } = useTheme();\n  const [socket, setSocket] = useState(null);\n  const [user, setUser] = useState(null);\n\n  const setupWebSocket = useCallback(() => {\n    if (!user) return; // 사용자가 로그인하지 않았다면 연결하지 않음\n\n    const newSocket = new WebSocket(`${WS_URL}/${user.id}`);\n\n    newSocket.onopen = () => {\n      console.log('WebSocket Connected');\n      setSocket(newSocket);\n    };\n\n    newSocket.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      if (data.type === 'user_count') {\n        setUserCount(data.count);\n      }\n    };\n\n    newSocket.onclose = () => {\n      console.log('WebSocket Disconnected');\n      setTimeout(() => {\n        console.log('Attempting to reconnect...');\n        setupWebSocket();\n      }, 5000);  // 5초 후 재연결 시도\n    };\n\n    newSocket.onerror = (error) => {\n      console.error('WebSocket Error:', error);\n    };\n  }, [user]);\n\n  useEffect(() => {\n    if (user) {\n      setupWebSocket();\n    }\n    return () => {\n      if (socket) {\n        socket.close();\n      }\n    };\n  }, [user, setupWebSocket]);\n\n  const handleAuthButton = (type) => {\n    setAuthType(type);\n    setShowAuthModal(true);\n  };\n\n  const handleCloseModal = () => {\n    setShowAuthModal(false);\n    setAuthType(null);\n  };\n\n  const handleLoginSuccess = useCallback((userData) => {\n    console.log('Login successful:', userData);\n    setUser(userData);\n    handleCloseModal();\n  }, []);\n\n  const handleLogout = () => {\n    setUser(null);\n    if (socket) {\n      socket.close();\n    }\n  };\n\n  return (\n    <div className={`App ${isDarkMode ? 'dark-mode' : 'light-mode'}`}>\n      <div className=\"main-section\">\n        <header className=\"main-header\">\n          <h1>채팅 애플리케이션</h1>\n        </header>\n        <main className=\"main-content\">\n          {/* 여기에 메인 콘텐츠가 들어갑니다 */}\n        </main>\n      </div>\n      <aside className=\"side-container\">\n        <header className=\"side-header\">\n          <div className=\"user-count\">현재 접속자 수: {userCount}</div>\n          <div className=\"header-buttons\">\n            {user ? (\n              <>\n                <span className=\"user-nickname\">{user.username}님 환영합니다</span>\n                <button onClick={handleLogout} className=\"logout-button\">로그아웃</button>\n              </>\n            ) : (\n              <>\n                <button onClick={() => handleAuthButton('login')}>로그인</button>\n                <button onClick={() => handleAuthButton('register')}>회원가입</button>\n              </>\n            )}\n            <button onClick={toggleTheme} className=\"theme-toggle\">\n              {isDarkMode ? '라이트' : '다크'}\n            </button>\n          </div>\n        </header>\n        <ChatPage socket={socket} user={user} />\n      </aside>\n      {showAuthModal && (\n        <div className=\"modal-backdrop\">\n          <AuthModal \n            type={authType} \n            onClose={handleCloseModal}\n            onLoginSuccess={handleLoginSuccess}\n          />\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <ThemeProvider>\n      <AppContent />\n    </ThemeProvider>\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}